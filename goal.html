<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Goal Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --green-field-dark: #004d40;
            --green-field-light: #2e7d32;
            --ball-yellow: #ffeb3b;
            --goal-orange: #ff9800;
            --bomb-red: #d32f2f;
            --text-color-light: #ecf0f1;
            --text-color-dark: #2c3e50;
            --grid-bg: #212121;
            --cell-bg-default: #424242;
            --cell-border-default: #616161;
            --highlight-green: #4CAF50;
            --dark-brown: #3e2723;
        }

        body {
            font-family: 'Orbitron', sans-serif; /* Mais moderno e legível */
            background: linear-gradient(180deg, var(--green-field-dark) 0%, #00251a 100%);
            color: var(--text-color-light);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            text-align: center;
            overflow-x: hidden;
            background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIHhtbG5zPSJodHRwOi8vd3d3Ln33ub3JnLzIwMDAvc3ZnIj4KICAgIDxnIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICAgICAgPHBhdGggZmlsbD0iIzAwNFQ0MCIgZD0iTSAwIDBoMjAwdi0yMDBIMCIvPgogICAgICAgIDxwYXRoIGQ9Ik0wIDAgTCA1MCAtNTAgTCAxMDAgMCAgTCA1MCA1MCBMIDAgMCBaIiBmaWxsPSJyZ2JhKDAsMCAwLDAuMDUpIiAvPgogICAgICAgIDxwYXRoIGQ9Ik01MCAtNTAgTCAxMDAgLTIwMCBMIDE1MCAtNTAgTCAxMDAgMCAgTCA1MCAtNTAgWiIgZmlsbD0icmdiYSgwLDAsMCwwLjA1KSIgLz4KICAgIDwvZz4KPC9zdmc+'); /* Padrão sutil de grama */
            background-size: 200px 200px;
        }

        h1 {
            font-family: 'Press Start 2P', cursive; /* Mantido para o título */
            color: var(--ball-yellow);
            margin-bottom: 25px;
            font-size: 3.2em;
            text-shadow: 0 0 15px rgba(255, 235, 59, 0.8), 0 0 25px rgba(255, 235, 59, 0.5);
            letter-spacing: 2px;
            animation: bounceTitle 1.5s infinite alternate;
        }

        @keyframes bounceTitle {
            0% { transform: translateY(0); }
            100% { transform: translateY(-8px); }
        }

        #balance {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8em;
            font-weight: bold;
            color: var(--goal-orange);
            margin-bottom: 30px;
            background: linear-gradient(to right, #4CAF50, #8BC34A); /* Mais vibrante */
            padding: 10px 25px;
            border-radius: 15px;
            box-shadow: 0 0 25px rgba(255, 152, 0, 0.8), inset 0 0 10px rgba(255, 255, 255, 0.2);
            border: 3px solid #FF5722;
            position: relative;
            overflow: hidden;
        }
        #balance::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(255,255,255,0.15) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.15) 50%, rgba(255,255,255,0.15) 75%, transparent 75%, transparent);
            background-size: 20px 20px;
            opacity: 0.2;
        }
        #currentBalance {
            color: white; /* Cor do saldo mais clara */
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .game-container {
            background: linear-gradient(160deg, #2c3e50, #1a242d); /* Degradê azul-cinza */
            padding: 35px;
            border-radius: 25px;
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.8), inset 0 0 20px rgba(0, 0, 0, 0.5);
            border: 5px solid var(--highlight-green);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 25px;
            max-width: 650px; /* Um pouco mais largo */
            width: 90%;
            position: relative;
            overflow: hidden; /* Para garantir que o gradiente da borda se comporte */
        }
        .game-container::before {
            content: '';
            position: absolute;
            top: -5px; bottom: -5px; left: -5px; right: -5px;
            background: linear-gradient(45deg, #4CAF50, #8BC34A, #FFEB3B, #FF9800);
            z-index: -1;
            filter: blur(10px);
            opacity: 0.6;
            border-radius: 28px;
        }


        .grid {
            display: grid;
            gap: 10px; /* Espaçamento maior */
            width: 100%;
            max-width: 550px; 
            margin-bottom: 20px;
            padding: 5px; /* Pequeno padding para o grid */
            box-sizing: border-box;
            background-color: rgba(0, 0, 0, 0.3); /* Fundo mais escuro para as células */
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* Define o número de colunas baseado na variável CSS */
        .grid[data-cols="3"] { grid-template-columns: repeat(3, 1fr); }
        .grid[data-cols="4"] { grid-template-columns: repeat(4, 1fr); }
        .grid[data-cols="5"] { grid-template-columns: repeat(5, 1fr); }


        .cell {
            width: 80px; 
            height: 80px;
            background: linear-gradient(145deg, #4a4a4a, #333333); /* Degradê para profundidade */
            border-radius: 12px; /* Cantos mais arredondados */
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3em;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s, box-shadow 0.2s, opacity 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5), inset 0 0 10px rgba(255, 255, 255, 0.1);
            border: 2px solid #555;
            color: transparent; 
            box-sizing: border-box;
            position: relative; /* Para efeitos internos */
            overflow: hidden;
        }
        .cell::before { /* Efeito de brilho na borda */
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            border-radius: 12px;
            border: 2px solid transparent;
            background: linear-gradient(45deg, #757575, #b0b0b0) border-box;
            -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
        }
        .cell:hover:not(.revealed):not(.disabled)::before {
            opacity: 1;
        }

        /* Ajustes para células em grids maiores/menores */
        .grid[data-cols="4"] .cell { width: 70px; height: 70px; font-size: 2.8em; border-radius: 10px; }
        .grid[data-cols="3"] .cell { width: 90px; height: 90px; font-size: 3.2em; border-radius: 15px; }


        /* Ajuste para que as células se redimensionem em telas menores */
        @media (max-width: 480px) {
            .cell {
                width: 55px;
                height: 55px;
                font-size: 2.2em;
                border-radius: 10px;
            }
            .grid {
                max-width: 100%; 
                gap: 6px;
            }
            .grid[data-cols="3"] .cell { width: 75px; height: 75px; font-size: 2.8em; border-radius: 12px; }
            .grid[data-cols="4"] .cell { width: 60px; height: 60px; font-size: 2.5em; border-radius: 10px; }
            h1 { font-size: 2.2em; }
            #balance { font-size: 1.5em; padding: 8px 20px; }
            .game-container { padding: 25px; border-width: 4px; gap: 20px; }
            .action-buttons button { padding: 10px 20px; font-size: 1em; max-width: 150px; }
            .info-display { font-size: 0.9em; padding: 8px 10px; }
            .bet-input { width: 100px; padding: 8px; font-size: 1em; }
            .field-select-container label { font-size: 1em; }
            #fieldSize { padding: 6px; font-size: 1em; }
        }

        .cell:not(.revealed):not(.disabled):hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.7), inset 0 0 15px rgba(255, 255, 255, 0.2);
            background: linear-gradient(145deg, #5c5c5c, #444444);
        }

        .cell.revealed {
            cursor: default;
            background-color: #757575; 
            animation: revealCell 0.3s ease-out forwards;
            color: white; /* Faz o ícone aparecer */
        }
        @keyframes revealCell {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .cell.ball {
            background: linear-gradient(145deg, var(--green-field-light), #4CAF50);
            color: #fff;
            font-size: 2.8em; 
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5), inset 0 0 15px rgba(255, 255, 255, 0.4);
            border-color: #64dd17;
            animation: bounceBall 0.5s ease-out;
        }
        @keyframes bounceBall {
            0% { transform: translateY(-10px) scale(0.8); }
            50% { transform: translateY(5px) scale(1.1); }
            100% { transform: translateY(0) scale(1); }
        }


        .cell.bomb {
            background: linear-gradient(145deg, var(--bomb-red), #c62828);
            color: #fff;
            font-size: 2.8em; 
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5), inset 0 0 15px rgba(255, 255, 255, 0.4);
            border-color: #b71c1c;
            animation: explodeBomb 0.3s forwards;
        }
        @keyframes explodeBomb {
            0% { transform: scale(0.8); opacity: 0.8; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .cell.disabled {
            opacity: 0.6; /* Mais visível do que 0.5 */
            pointer-events: none; 
            filter: grayscale(50%); /* Efeito de desbotamento */
        }
        .cell.current-level {
            opacity: 1;
            pointer-events: auto; 
            filter: none;
            border-color: var(--ball-yellow); /* Destaca a linha atual */
            box-shadow: 0 0 15px rgba(255, 235, 59, 0.7), inset 0 0 5px rgba(255, 235, 59, 0.3);
        }


        .controls-panel {
            display: flex;
            flex-direction: column;
            gap: 20px; /* Espaçamento maior */
            align-items: center;
            width: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }

        .bet-input {
            width: 150px; /* Mais largo */
            padding: 12px;
            border-radius: 10px;
            border: 2px solid var(--highlight-green);
            background-color: #333;
            color: var(--text-color-light);
            font-size: 1.3em;
            text-align: center;
            margin-bottom: 10px;
            box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.7);
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .bet-input:focus {
            outline: none;
            border-color: var(--ball-yellow);
            box-shadow: inset 0 0 10px rgba(255, 235, 59, 0.5);
        }

        .field-select-container { 
            display: flex;
            align-items: center;
            gap: 15px; 
            margin-bottom: 10px;
            flex-wrap: wrap; 
            justify-content: center;
            padding: 8px 15px;
            background-color: rgba(0,0,0,0.2);
            border-radius: 8px;
        }

        .field-select-container label {
            font-size: 1.2em;
            color: var(--text-color-light);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        #fieldSize { 
            padding: 10px;
            border-radius: 8px;
            border: 2px solid var(--goal-orange);
            background-color: #333;
            color: var(--text-color-light);
            font-size: 1.2em;
            cursor: pointer;
            appearance: none; /* Remove estilo padrão do select */
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23ecf0f1%22%20d%3D%22M287%2069.1L174.1%20182c-6.7%206.7-17.7%206.7-24.4%200L5.3%2069.1c-6.7-6.7-6.7-17.7%200-24.4s17.7-6.7%2024.4%200l132.8%20132.8L262.6%2044.7c6.7-6.7%2017.7-6.7%2024.4%200s6.8%2017.7.1%2024.4z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 10px top 50%;
            background-size: 16px auto;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        #fieldSize:focus {
            outline: none;
            border-color: var(--ball-yellow);
            box-shadow: 0 0 10px var(--ball-yellow);
        }


        .action-buttons {
            display: flex;
            gap: 20px; 
            width: 100%;
            justify-content: center;
            flex-wrap: wrap; 
        }

        .action-buttons button {
            padding: 15px 30px;
            font-size: 1.3em;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s, box-shadow 0.2s;
            font-weight: bold;
            color: white;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.5);
            flex-grow: 1; 
            max-width: 220px; /* Mais largo */
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        #betButton {
            background: linear-gradient(to right, #27ae60, #2ecc71); 
            border: 2px solid #2ecc71;
        }
        #betButton:hover {
            background: linear-gradient(to right, #2ecc71, #27ae60);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(46, 204, 113, 0.6);
        }
        #betButton:active {
            transform: translateY(0);
            box-shadow: 0 4px 10px rgba(46, 204, 113, 0.4);
        }
        #betButton:disabled {
            background: #6c7a89;
            border-color: #5d6d7e;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        #cashOutButton {
            background: linear-gradient(to right, #f39c12, #e67e22); 
            border: 2px solid #e67e22;
        }
        #cashOutButton:hover {
            background: linear-gradient(to right, #e67e22, #f39c12);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(243, 156, 18, 0.6);
        }
        #cashOutButton:active {
            transform: translateY(0);
            box-shadow: 0 4px 10px rgba(243, 156, 18, 0.4);
        }
        #cashOutButton:disabled {
            background: #a5a5a5;
            border-color: #8c8c8c;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        .info-display {
            width: 100%;
            display: flex;
            justify-content: space-around; /* Espaçamento mais uniforme */
            align-items: center;
            background-color: #34495e;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 1.2em;
            color: #bdc3c7;
            margin-top: 15px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
            border: 1px solid #2c3e50;
            flex-wrap: wrap;
            gap: 10px;
        }

        .info-display div { /* Usar div para envolver label e span para melhor controle */
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1 1 45%; 
        }
        .info-display div span {
            font-weight: bold;
            color: var(--text-color-light);
            margin-top: 5px;
            font-size: 1.1em;
        }
        .info-display div:first-child span { color: var(--ball-yellow); }
        .info-display div:last-child span { color: var(--highlight-green); }


        .message-display {
            margin-top: 20px;
            font-size: 1.3em;
            font-weight: bold;
            color: var(--ball-yellow);
            min-height: 1.5em;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.7);
            animation: fadeInOutMessage 3s forwards; /* Animação para mensagens */
        }
        @keyframes fadeInOutMessage {
            0% { opacity: 0; transform: translateY(-10px); }
            10% { opacity: 1; transform: translateY(0); }
            90% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(10px); }
        }
        
        .back-button {
            margin-top: 50px;
            padding: 15px 30px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.2em;
            text-decoration: none;
            transition: background-color 0.2s, transform 0.1s, box-shadow 0.2s;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.5);
            text-transform: uppercase;
        }

        .back-button:hover {
            background-color: #2980b9;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.7);
        }
        .back-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(52, 152, 219, 0.3);
        }

        /* Confetti for Goal */
        #confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 9999;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f1c40f;
            border-radius: 50%;
            opacity: 0;
            animation: fall 3s ease-out forwards;
        }

        @keyframes fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

    </style>
</head>
<body>
    <h1>Goal Game</h1>

    <div id="balance">Saldo: <span id="currentBalance">0.00</span> BRL</div>

    <div class="game-container">
        <div class="grid" id="gameGrid"></div>

        <div class="controls-panel">
            <input type="number" id="betAmount" class="bet-input" value="1.00" min="0.50" step="0.50">

            <div class="field-select-container">
                <label for="fieldSize">Campo:</label>
                <select id="fieldSize">
                    <option value="small">Small (3x4)</option>
                    <option value="medium">Medium (4x7)</option>
                    <option value="large">Large (5x10)</option>
                </select>
            </div>

            <div class="info-display">
                <div>
                    Ganhos Potenciais: <span id="potentialPayout">0.00x</span>
                </div>
                <div>
                    Próximo Gol: <span id="nextGoalPayout">0.00x</span>
                </div>
            </div>

            <div class="action-buttons">
                <button id="betButton">Começar Partida</button>
                <button id="cashOutButton" disabled>Sacar (0.00)</button>
            </div>
            <div class="message-display" id="gameMessage"></div>
        </div>
    </div>

    <a href="index.html" class="back-button">Voltar para a Página Principal</a>

    <div id="confetti-container"></div>

    <script>
        const currentBalanceDisplay = document.getElementById('currentBalance');
        const gameGrid = document.getElementById('gameGrid');
        const betAmountInput = document.getElementById('betAmount');
        const fieldSizeSelect = document.getElementById('fieldSize');
        const betButton = document.getElementById('betButton');
        const cashOutButton = document.getElementById('cashOutButton');
        const potentialPayoutDisplay = document.getElementById('potentialPayout');
        const nextGoalPayoutDisplay = document.getElementById('nextGoalPayout');
        const gameMessageDisplay = document.getElementById('gameMessage');
        const confettiContainer = document.getElementById('confetti-container');

        let playerBalance = 0;
        let gameActive = false;
        let currentBet = 0;
        let currentPayoutMultiplier = 1.00; 
        
        let numRows = 0; 
        let numCols = 0; 
        
        let currentLevel = 0; 
        let bombPositions = []; 

        const fieldDefinitions = {
            small: { rows: 4, cols: 3 },
            medium: { rows: 7, cols: 4 },
            large: { rows: 10, cols: 5 }
        };

        // Sons (certifique-se de ter os arquivos nos locais corretos)
        const clickSound = new Audio('click_sound.mp3'); 
        const winSound = new Audio('slot_win.mp3'); 
        const loseSound = new Audio('slot_lose.mp3'); 
        const cashOutSound = new Audio('cash_out.mp3'); 

        function saveBalance() {
            localStorage.setItem('minesPlayerBalance', playerBalance.toFixed(2));
        }

        function loadBalance() {
            const savedBalance = localStorage.getItem('minesPlayerBalance');
            if (savedBalance !== null) {
                playerBalance = parseFloat(savedBalance);
            } else {
                playerBalance = 20.00; 
            }
        }

        function updateBalanceDisplay() {
            currentBalanceDisplay.textContent = playerBalance.toFixed(2);
            saveBalance();
        }

        function calculatePayouts() {
            const selectedField = fieldSizeSelect.value;
            const { rows, cols } = fieldDefinitions[selectedField];
            
            const multiplierPerLevel = cols / (cols - 1); 

            let finalPotentialMultiplier = 1.00;
            for(let i = 0; i < rows; i++) {
                finalPotentialMultiplier *= multiplierPerLevel;
            }
            potentialPayoutDisplay.textContent = `${finalPotentialMultiplier.toFixed(2)}x`;

            if (gameActive && currentLevel < rows) {
                nextGoalPayoutDisplay.textContent = `${(currentPayoutMultiplier * multiplierPerLevel).toFixed(2)}x`;
            } else if (!gameActive) {
                nextGoalPayoutDisplay.textContent = `${multiplierPerLevel.toFixed(2)}x`;
            } else {
                nextGoalPayoutDisplay.textContent = '---'; 
            }

            if (gameActive && currentLevel > 0) { 
                cashOutButton.textContent = `Sacar (${(currentBet * currentPayoutMultiplier).toFixed(2)})`;
            } else {
                cashOutButton.textContent = `Sacar (0.00)`;
            }
        }

        function startGame() {
            const betAmount = parseFloat(betAmountInput.value);
            if (isNaN(betAmount) || betAmount <= 0) {
                gameMessageDisplay.textContent = "Aposta inválida!";
                return;
            }
            if (betAmount > playerBalance) {
                gameMessageDisplay.textContent = "Saldo insuficiente!";
                return;
            }

            playerBalance -= betAmount;
            updateBalanceDisplay();
            currentBet = betAmount;
            currentPayoutMultiplier = 1.00; 
            currentLevel = 0; 
            gameActive = true;
            gameMessageDisplay.textContent = "Jogo iniciado! Selecione uma célula na primeira fileira.";
            
            betButton.disabled = true;
            betAmountInput.disabled = true;
            fieldSizeSelect.disabled = true; 
            cashOutButton.disabled = true; 
            cashOutButton.textContent = `Sacar (0.00)`;

            const selectedField = fieldSizeSelect.value;
            numRows = fieldDefinitions[selectedField].rows;
            numCols = fieldDefinitions[selectedField].cols;

            generateGrid();
            placeBombs(); 
            enableCurrentLevelCells(); 
            calculatePayouts(); 
        }

        function generateGrid() {
            gameGrid.innerHTML = '';
            gameGrid.dataset.cols = numCols; 
            gameGrid.style.gridTemplateRows = `repeat(${numRows}, 1fr)`;

            for (let r = 0; r < numRows; r++) {
                for (let c = 0; c < numCols; c++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    cell.dataset.row = r; 
                    cell.dataset.col = c; 
                    cell.addEventListener('click', handleCellClick);
                    gameGrid.appendChild(cell);
                }
            }
        }

        function placeBombs() {
            bombPositions = [];
            for (let r = 0; r < numRows; r++) {
                bombPositions[r] = Math.floor(Math.random() * numCols); 
            }
        }

        function enableCurrentLevelCells() {
            const cells = gameGrid.querySelectorAll('.cell');
            cells.forEach(cell => {
                const row = parseInt(cell.dataset.row);
                if (row === currentLevel && !cell.classList.contains('revealed')) {
                    cell.classList.add('current-level'); 
                    cell.classList.remove('disabled');
                } else {
                    cell.classList.add('disabled'); 
                    cell.classList.remove('current-level');
                }
            });
        }

        function revealRow(rowToReveal, showAllBombs = false) {
            const cellsInRow = gameGrid.querySelectorAll(`.cell[data-row="${rowToReveal}"]`);
            cellsInRow.forEach(cell => {
                const col = parseInt(cell.dataset.col);
                cell.classList.add('revealed'); // Adiciona a classe 'revealed' a todas as células da linha
                if (col === bombPositions[rowToReveal]) { 
                    cell.classList.add('bomb');
                    cell.innerHTML = '💥';
                } else { 
                    cell.classList.add('ball');
                    cell.innerHTML = '⚽';
                }
                cell.classList.add('disabled'); 
                cell.classList.remove('current-level');
                cell.removeEventListener('click', handleCellClick);
            });
        }

        function handleCellClick(event) {
            if (!gameActive) return;

            const cell = event.target;
            const row = parseInt(cell.dataset.row);
            const col = parseInt(cell.dataset.col);

            if (row !== currentLevel || cell.classList.contains('revealed')) {
                return; 
            }

            clickSound.currentTime = 0;
            clickSound.play();

            if (col === bombPositions[row]) {
                cell.classList.add('bomb');
                cell.innerHTML = '💥';
                gameMessageDisplay.textContent = "BOOM! Você atingiu uma bomba. Fim de jogo.";
                loseSound.currentTime = 0;
                loseSound.play();
                endGame(false);
            } else {
                cell.classList.add('ball');
                cell.innerHTML = '⚽';
                winSound.currentTime = 0;
                winSound.play();

                const selectedField = fieldSizeSelect.value;
                const { cols } = fieldDefinitions[selectedField];
                currentPayoutMultiplier *= (cols / (cols - 1)); 
                
                gameMessageDisplay.textContent = `Gol! Multiplicador atual: ${currentPayoutMultiplier.toFixed(2)}x. Prossiga para a próxima fileira!`;
                cashOutButton.disabled = false; 
                
                // Revela toda a linha atual após o acerto
                revealRow(row); 

                currentLevel++; 
                
                if (currentLevel < numRows) {
                    enableCurrentLevelCells(); 
                    calculatePayouts(); 
                } else {
                    gameMessageDisplay.textContent = `PARABÉNS! Você encontrou todas as ${numRows} bolas! Você ganhou R$ ${(currentBet * currentPayoutMultiplier).toFixed(2)}.`;
                    endGame(true);
                }
            }
        }

        function endGame(won) {
            gameActive = false;
            betButton.disabled = false;
            betAmountInput.disabled = false;
            fieldSizeSelect.disabled = false; 
            cashOutButton.disabled = true;

            // Revela todas as bombas e bolas restantes na grade
            for (let r = 0; r < numRows; r++) {
                revealRow(r, true); 
            }

            if (won && currentPayoutMultiplier > 1.00) { 
                playerBalance += (currentBet * currentPayoutMultiplier);
                updateBalanceDisplay();
                cashOutSound.currentTime = 0;
                cashOutSound.play();
                launchConfetti();
            } 
            
            cashOutButton.textContent = `Sacar (0.00)`; 
            calculatePayouts(); 
        }

        function cashOut() {
            if (!gameActive || currentLevel === 0) return; 

            const winnings = currentBet * currentPayoutMultiplier;
            gameMessageDisplay.textContent = `Você sacou R$ ${winnings.toFixed(2)}!`;
            cashOutSound.currentTime = 0;
            cashOutSound.play();
            launchConfetti();
            endGame(true); 
        }

        function launchConfetti() {
            const colors = ['#f44336', '#4caf50', '#2196f3', '#ffeb3b', '#9c27b0', '#ff9800'];
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
                confetti.style.left = `${Math.random() * 100}vw`;
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDuration = `${Math.random() * 2 + 3}s`;
                confetti.style.animationDelay = `${Math.random() * 0.5}s`;
                confettiContainer.appendChild(confetti);

                confetti.addEventListener('animationend', () => {
                    confetti.remove();
                });
            }
        }

        // Initial setup
        loadBalance();
        updateBalanceDisplay();
        fieldSizeSelect.addEventListener('change', calculatePayouts); 
        betButton.addEventListener('click', startGame);
        cashOutButton.addEventListener('click', cashOut);
        
        clickSound.load();
        winSound.load();
        loseSound.load();
        cashOutSound.load();

        const initialField = fieldSizeSelect.value;
        numRows = fieldDefinitions[initialField].rows;
        numCols = fieldDefinitions[initialField].cols;
        generateGrid(); 
        calculatePayouts(); 
    </script>
</body>
</html>